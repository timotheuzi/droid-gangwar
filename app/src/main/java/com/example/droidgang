package com.example.droidgangwar.data

import com.example.droidgangwar.model.RandomEvent
import com.example.droidgangwar.model.EventType
import kotlin.random.Random

object RandomEventData {
    
    private val wanderEvents = listOf(
        "You wander the bustling streets of the city, your footsteps echoing off cracked sidewalks littered with cigarette butts and crumpled fast-food wrappers, when you spot a worn leather wallet half-hidden beneath a pile of discarded newspapers. As you pick it through the grime, you discover $50 in crumpled bills and a few expired credit cards, the previous owner's misfortune becoming your unexpected windfall in this unforgiving urban jungle.",
        
        "You encounter a street performer on a crowded corner, his guitar case open for donations as he strums soulful melodies that cut through the city's constant din. He pauses his song to give you some insider tips about the local scene - which alleys to avoid after dark, which bars serve the cheapest drinks, and which neighborhoods are currently under gang control, his weathered face telling stories of a life lived on the edge of society's underbelly.",
        
        "You overhear a group of heavily tattooed gang members huddled in a shadowy doorway, their low voices carrying snippets of conversation about upcoming turf wars and power struggles. Their gold chains glint under the streetlights as they discuss rival crews, planned hits, and the shifting alliances that keep the city's criminal underworld in constant flux, their words painting a picture of a dangerous game where one wrong move could mean the difference between ruling the streets or ending up in an unmarked grave.",
        
        "You find a quiet spot tucked away in a small park where the city's relentless pace seems to slow for just a moment, the grass worn thin by countless footsteps and the benches scarred with graffiti tags. You sit and rest, letting the relative peace wash over you as your body begins to heal from the accumulated wounds of street life, the distant sounds of traffic and sirens fading into background noise as you regain some much-needed health and clarity of mind.",
        
        "You notice some suspicious activity unfolding in a nearby alley - shadowy figures exchanging packages in hurried whispers, their nervous glances and fidgeting hands betraying the illicit nature of their transaction. You decide to keep moving, your instincts screaming that getting involved would only lead to trouble, the air thick with tension as you slip away unnoticed, leaving whatever shady deal was about to go down to unfold without your participation.",
        
        "You bump into an old contact from your past life on the streets, his face lined with the hard years and his clothes hanging loose on a frame that's seen too many lean times. He pulls you aside and shares some juicy gossip about recent events - which gang leaders have fallen out of favor, which cops are on the take, and which new players are making moves to claim territory, his words a valuable currency in the information-starved world of street hustling.",
        
        "You wander into a rough neighborhood where the buildings seem to lean in threateningly and the streets are patrolled by wary locals who size you up as a potential threat. The air is thick with the scent of cooking grease mixed with something more acrid, and you narrowly avoid trouble by keeping your head down and moving with purpose, the hostile stares following you like shadows until you finally escape back to more familiar territory.",
        
        "You find some discarded drugs carelessly left behind in a filthy alley, the small packages wrapped in plastic and hidden beneath a pile of rotting garbage that makes your stomach turn. Worth $200 on the street, this unexpected score represents someone's carelessness becoming your opportunity, the drugs promising either profit through resale or personal use to dull the sharp edges of life in the city's unforgiving underbelly.",
        
        "You help a local shopkeeper who's struggling with a heavy delivery, his small grocery store tucked between two towering apartment buildings that block out most of the sunlight. In gratitude, he rewards you with valuable information about the neighborhood - which buildings have working elevators, which back alleys lead to quick escapes, and which local characters are worth knowing, his words proving more valuable than any cash payment in this information-driven world.",
        
        "You wander around the city without incident, the streets flowing past you like a familiar but dangerous river that you navigate with the practiced ease of someone who's learned to survive its currents. The crowds part around you, the vendors hawk their wares, and the traffic flows in its endless rhythm, giving you a brief respite from the constant threats and opportunities that define life in this sprawling metropolis of concrete and ambition.",
        
        "You see a police patrol cruising slowly down the street, their spotlights cutting through the gathering dusk like accusatory fingers searching for wrongdoing. You quickly duck into a nearby alley, pressing yourself against the cold brick wall as the cruiser passes, your heart pounding with the familiar mix of adrenaline and paranoia that comes from living a life that exists in the gray areas between legal and illegal, the sirens fading into the distance as you catch your breath.",
        
        "You find a hidden stash of weapons cleverly concealed behind a loose brick in an abandoned building, the cold metal gleaming in the dim light filtering through cracked windows. A small cache of ammunition and perhaps a few extra firearms that could turn the tide in a street confrontation, this discovery represents the kind of opportunity that keeps people coming back to the city's dangerous underbelly, where fortunes can be made or lost in the blink of an eye.",
        
        "You encounter a beggar huddled in a doorway, his clothes ragged and his face weathered by exposure to the elements and the hard knocks of street life. He tells you about secret locations scattered throughout the city - hidden speakeasies where deals are made, abandoned warehouses that serve as temporary hideouts, and forgotten tunnels that connect different parts of the underworld, his words a map to places that most people never even know exist.",
        
        "You wander through a vibrant market district where vendors shout their prices and haggle with customers over everything from fresh produce to stolen electronics, the air thick with the mingled scents of spices, street food, and the underlying musk of urban commerce. You engage in some spirited bargaining, managing to get better prices on various goods through a combination of charm, persistence, and the subtle art of negotiation that defines successful street-level trading.",
        
        "You stumble upon a gang recruitment drive taking place in a dimly lit parking lot, where charismatic leaders try to convince impressionable young men and women to join their crews with promises of money, power, and protection. The recruiters speak passionately about loyalty, territory, and the brotherhood of the streets, their words painting a picture of excitement and danger that both repels and attracts those looking for a way to escape the drudgery of ordinary life in the city."
    )
    
    private val babyMommaMessages = listOf(
        "Your baby momma storms into the bar and starts yelling about child support!",
        "You spot your ex at the bar counter demanding money for the kids!",
        "A woman approaches you at the bar claiming you're the father of her child and demands $500!",
        "Trouble! Your baby momma confronts you at the bar about missed payments!",
        "Your baby momma spots you from across the street and starts yelling about child support!",
        "You run into one of your many baby mommas who demands money for the kids!",
        "A woman approaches you claiming you're the father of her child and demands $500!",
        "You see your ex approaching with a determined look - she wants money for the kids!"
    )
    
    private val policeMessages = listOf(
        "Oh no! A plainclothes officer spots you and calls for backup! 3 police officers give chase!",
        "Police sirens blare as officers spot you in suspicious activity! 4 cops converge on your position!",
        "A police patrol spots your gang insignia and decides to investigate! 5 officers surround you!",
        "You notice the police staking out the area - time to move before you're caught!",
        "Undercover cops approach with badges visible - better make a run for it!"
    )
    
    private val gangFightMessages = listOf(
        "Rival gang members push their way into the bar looking for trouble! They spot you and 4 thugs start a fight!",
        "Your gang's colors attract unwanted attention from rival territory! 6 gang members converge on your location!",
        "A territorial dispute erupts as you walk through hostile neighborhood! 5 rival gang members challenge you!",
        "Your reputation precedes you as local criminals decide to test your crew! 3 thugs attempt a drive-by!",
        "A gang war spills into the streets where you're caught in the crossfire! 4 armed enemies surround you!"
    )
    
    private val squidieMessages = listOf(
        "Oh no! Squidie spies overheard you bragging about your gang! A hit squad of 3 members bursts through the door!",
        "The Squidies have sent their best killers to eliminate your threat! 4 hardened assassins corner you!",
        "A Squidie death squad tracks you down - they don't leave witnesses! 5 elite soldiers open fire!",
        "Your gang's success has attracted unwanted attention from the Squidies! 2 heavily armed enforcers close in!",
        "The Squidies launch a surprise attack on your territory! 4 deadly operatives assault your position!"
    )
    
    fun generateRandomEvent(gameState: com.example.droidgangwar.model.GameState): RandomEvent {
        val random = Random(System.currentTimeMillis())
        
        // Event probabilities based on gangwar_ref source
        val eventTypes = when {
            random.nextFloat() < 0.08f -> EventType.BABY_MOMMA_INCIDENT // 8% chance
            random.nextFloat() < 0.10f -> EventType.POLICE_CHASE // 10% chance (cumulative)
            random.nextFloat() < 0.22f -> EventType.GANG_FIGHT // 12% chance (cumulative)
            random.nextFloat() < 0.24f -> EventType.SQUIDIE_HIT_SQUAD // 2% chance (cumulative, scales with gang power)
            random.nextFloat() < 0.39f -> EventType.NPC_ENCOUNTER // 15% chance (cumulative)
            else -> EventType.TREASURE_FIND // Remaining 61% chance for peaceful events
        }
        
        return when (eventTypes) {
            EventType.BABY_MOMMA_INCIDENT -> RandomEvent(
                id = "baby_momma_${System.currentTimeMillis()}",
                title = "Baby Momma Encounter",
                description = babyMommaMessages.random(),
                type = EventType.BABY_MOMMA_INCIDENT,
                effects = mapOf(
                    "money" to -200, // Lose money if you have it
                    "damage" to if (random.nextBoolean()) 10 else 0 // Sometimes take damage
                )
            )
            
            EventType.POLICE_CHASE -> RandomEvent(
                id = "police_${System.currentTimeMillis()}",
                title = "Police Chase",
                description = policeMessages.random(),
                type = EventType.POLICE_CHASE,
                effects = mapOf(
                    "health" to -15 // Take some damage from bullets
                ),
                requirements = mapOf(
                    "has_id" to (gameState.flags.hasId == false) // Only if you don't have fake ID
                )
            )
            
            EventType.GANG_FIGHT -> RandomEvent(
                id = "gang_${System.currentTimeMillis()}",
                title = "Gang Fight",
                description = gangFightMessages.random(),
                type = EventType.GANG_FIGHT,
                effects = mapOf(
                    "damage" to 20,
                    "members" to 1 // Chance to gain a member
                )
            )
            
            EventType.SQUIDIE_HIT_SQUAD -> RandomEvent(
                id = "squidie_${System.currentTimeMillis()}",
                title = "Squidie Hit Squad",
                description = squidieMessages.random(),
                type = EventType.SQUIDIE_HIT_SQUAD,
                effects = mapOf(
                    "damage" to 25,
                    "squidies" to -1 // Take down one Squidie
                ),
                requirements = mapOf(
                    "members" to gameState.members >= 3 // Only when you have gang presence
                )
            )
            
            EventType.NPC_ENCOUNTER -> RandomEvent(
                id = "npc_${System.currentTimeMillis()}",
                title = "NPC Encounter",
                description = "You encounter a mysterious figure in the shadows who offers you something interesting...",
                type = EventType.NPC_ENCOUNTER,
                effects = mapOf(
                    "money" to random.nextInt(-100, 500), // Could gain or lose money
                    "health" to if (random.nextBoolean()) 10 else 0 // Heal sometimes
                )
            )
            
            EventType.TREASURE_FIND -> RandomEvent(
                id = "treasure_${System.currentTimeMillis()}",
                title = "Treasure Found",
                description = wanderEvents.random(),
                type = EventType.TREASURE_FIND,
                effects = mapOf(
                    "money" to random.nextInt(50, 300),
                    "health" to if (random.nextFloat() < 0.3f) 15 else 0 // 30% chance to heal
                )
            )
            
            EventType.HEALTH_REST -> RandomEvent(
                id = "health_${System.currentTimeMillis()}",
                title = "Safe Resting Spot",
                description = "You find a quiet corner where you can tend to your wounds and rest for a moment.",
                type = EventType.HEALTH_REST,
                effects = mapOf(
                    "health" to 20
                )
            )
            
            EventType.MONEY_FIND -> RandomEvent(
                id = "money_${System.currentTimeMillis()}",
                title = "Money Discovery",
                description = "You stumble upon some discarded cash hidden in an unexpected place.",
                type = EventType.MONEY_FIND,
                effects = mapOf(
                    "money" to random.nextInt(100, 400)
                )
            )
            
            EventType.DRUG_FIND -> RandomEvent(
                id = "drug_${System.currentTimeMillis()}",
                title = "Drug Stash",
                description = "You find some discarded drugs left behind by someone who needed to make a quick escape.",
                type = EventType.DRUG_FIND,
                effects = mapOf(
                    "drugs" to random.nextInt(1, 3)
                )
            )
            
            EventType.AMMO_FIND -> RandomEvent(
                id = "ammo_${System.currentTimeMillis()}",
                title = "Ammo Cache",
                description = "You discover a hidden cache of ammunition behind some loose bricks.",
                type = EventType.AMMO_FIND,
                effects = mapOf(
                    "bullets" to random.nextInt(10, 30)
                )
            )
            
            EventType.WEAPON_FIND -> RandomEvent(
                id = "weapon_${System.currentTimeMillis()}",
                title = "Weapon Discovery",
                description = "You find a discarded weapon that could prove useful in street confrontations.",
                type = EventType.WEAPON_FIND,
                effects = mapOf(
                    "weapons" to 1
                )
            )
        }
    }
    
    fun generateAlleywaySearchEvent(roomId: String, searchableItems: List<String>): RandomEvent {
        val random = Random(System.currentTimeMillis())
        val itemType = searchableItems.random()
        
        return when (itemType) {
            "money" -> RandomEvent(
                id = "search_${roomId}_${System.currentTimeMillis()}",
                title = "Hidden Cash",
                description = "You find some money hidden among the debris!",
                type = EventType.MONEY_FIND,
                effects = mapOf("money" to random.nextInt(50, 200))
            )
            
            "hidden_weapon" -> RandomEvent(
                id = "search_${roomId}_${System.currentTimeMillis()}",
                title = "Concealed Weapon",
                description = "You discover a concealed weapon tucked away!",
                type = EventType.WEAPON_FIND,
                effects = mapOf("weapons" to 1)
            )
            
            "trash" -> RandomEvent(
                id = "search_${roomId}_${System.currentTimeMillis()}",
                title = "Just Trash",
                description = "You search thoroughly but only find worthless trash.",
                type = EventType.TREASURE_FIND,
                effects = emptyMap()
            )
            
            "drugs" -> RandomEvent(
                id = "search_${roomId}_${System.currentTimeMillis()}",
                title = "Hidden Drugs",
                description = "You find a stash of drugs hidden away!",
                type = EventType.DRUG_FIND,
                effects = mapOf("drugs" to random.nextInt(1, 4))
            )
            
            "ammo" -> RandomEvent(
                id = "search_${roomId}_${System.currentTimeMillis()}",
                title = "Ammo Cache",
                description = "You find a cache of ammunition!",
                type = EventType.AMMO_FIND,
                effects = mapOf("bullets" to random.nextInt(5, 15))
            )
            
            else -> RandomEvent(
                id = "search_${roomId}_${System.currentTimeMillis()}",
                title = "Mixed Results",
                description = "You find a variety of items, some useful, some not.",
                type = EventType.TREASURE_FIND,
                effects = mapOf(
                    "money" to random.nextInt(25, 100),
                    "health" to if (random.nextFloat() < 0.2f) 10 else 0 // 20% chance to heal a bit
                )
            )
        }
    }
    
    fun hasMeetRequirements(event: RandomEvent, gameState: com.example.droidgangwar.model.GameState): Boolean {
        val requirements = event.requirements
        
        requirements.forEach { (key, value) ->
            when (key) {
                "has_id" -> if (gameState.flags.hasId != value) return false
                "members" -> if (gameState.members < (value as Int)) return false
            }
        }
        
        return true
    }
    
    fun applyEventEffects(event: RandomEvent, gameState: com.example.droidgangwar.model.GameState) {
        val effects = event.effects
        
        effects.forEach { (key, value) ->
            when (key) {
                "money" -> gameState.money += value
                "health" -> gameState.health = minOf(gameState.maxHealth, gameState.health + value)
                "damage" -> gameState.takeDamage(value)
                "members" -> gameState.members += value
                "squidies" -> gameState.squidies = maxOf(0, gameState.squidies + value)
                "drugs" -> gameState.drugs.crack += value // Default to crack for simple implementation
                "bullets" -> gameState.weapons.bullets += value
                "weapons" -> {
                    when (event.type) {
                        EventType.WEAPON_FIND -> {
                            if (value > 0) {
                                gameState.weapons.pistols += 1
                            }
                        }
                    }
                }
            }
        }
    }
